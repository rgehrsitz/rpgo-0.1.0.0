# TSP Configuration for Monte Carlo Simulations

## Overview

When running Monte Carlo simulations with the FERS retirement calculator, TSP balance projections require specific configuration to show proper market variability. This document explains the configuration requirements and limitations.

## The Issue

Monte Carlo simulations are designed to model varying market conditions to assess retirement plan risk. However, certain TSP configuration approaches can result in identical TSP balance projections across all percentiles, defeating the purpose of the simulation.

## Solution

### ✅ Use Manual TSP Allocations

For Monte Carlo simulations, configure employees with **manual TSP allocations**:

```yaml
personal_details:
  employee_name:
    # Other employee details...
    
    # Manual TSP allocation (recommended for Monte Carlo)
    tsp_allocation:
      c_fund: "0.60"  # 60% C Fund (Large Cap Stock Index)
      s_fund: "0.20"  # 20% S Fund (Small Cap Stock Index)
      i_fund: "0.10"  # 10% I Fund (International Stock Index)
      f_fund: "0.10"  # 10% F Fund (Fixed Income Index)
      g_fund: "0.00"  # 0% G Fund (Government Securities)
```

### ❌ Avoid TSP Lifecycle Funds

**Do not use** TSP lifecycle fund configurations for Monte Carlo simulations:

```yaml
# This will produce identical results across all Monte Carlo simulations
# tsp_lifecycle_fund:
#   fund_name: "L2030"  # Avoid for Monte Carlo
```

## Why This Limitation Exists

1. **Lifecycle Fund Behavior**: TSP lifecycle funds use **deterministic allocation calculations** based on target retirement dates and current dates.

2. **Monte Carlo Incompatibility**: These deterministic allocations don't change based on the varying market conditions generated by Monte Carlo simulations.

3. **Result**: All simulations end up using identical allocation percentages, leading to nearly identical TSP balance projections regardless of market variability.

## Impact on Results

### With Manual Allocations (Correct)
Monte Carlo HTML reports show proper TSP balance variation:
- **P10**: $2,849 (worst case)
- **P50**: $51,057,439 (median)  
- **P90**: $3,562,192,530 (best case)

### With Lifecycle Funds (Incorrect)
Monte Carlo HTML reports show identical TSP values:
- **P10**: $10,289,593
- **P25**: $10,289,593
- **P50**: $10,289,593
- **P75**: $10,289,593
- **P90**: $10,289,593

## Deterministic Calculations

For **regular deterministic calculations** (not Monte Carlo), both approaches work equivalently:
- Use either manual allocations or lifecycle funds
- Both will produce the same results for single-scenario projections

## Recommended TSP Allocations

### Conservative (Age 55+)
```yaml
tsp_allocation:
  c_fund: "0.30"  # 30% stocks
  s_fund: "0.10"  
  i_fund: "0.10"
  f_fund: "0.40"  # 40% bonds
  g_fund: "0.10"  # 10% guaranteed
```

### Moderate (Age 45-55)
```yaml
tsp_allocation:
  c_fund: "0.50"  # 50% stocks
  s_fund: "0.15"
  i_fund: "0.15"
  f_fund: "0.20"  # 20% bonds
  g_fund: "0.00"
```

### Aggressive (Age <45)
```yaml
tsp_allocation:
  c_fund: "0.60"  # 70% stocks total
  s_fund: "0.20"
  i_fund: "0.10"
  f_fund: "0.10"  # 10% bonds
  g_fund: "0.00"
```

## Migration Guide

If you have an existing configuration with lifecycle funds and want to run Monte Carlo simulations:

1. **Identify Current Allocation**: Check your actual TSP allocation percentages
2. **Convert to Manual**: Replace `tsp_lifecycle_fund` with equivalent `tsp_allocation`
3. **Test**: Run a small Monte Carlo simulation to verify variation appears
4. **Adjust**: Fine-tune allocations based on your risk tolerance

## Example Migration

**Before (Lifecycle Fund)**:
```yaml
robert:
  # ... other details
  tsp_lifecycle_fund:
    fund_name: "L2030"
```

**After (Manual Allocation)**:
```yaml
robert:
  # ... other details
  tsp_allocation:
    c_fund: "0.55"  # Approximate L2030 allocation
    s_fund: "0.15"
    i_fund: "0.15"
    f_fund: "0.10"
    g_fund: "0.05"
```

## Verification

To verify your Monte Carlo simulation is working correctly:

1. Run a simulation with manual TSP allocations
2. Check the HTML report TSP balance time series data
3. Confirm that P10, P25, P50, P75, P90 percentiles show different values
4. If all percentiles are identical, double-check that no lifecycle funds are configured

## Future Improvements

This limitation may be addressed in future versions by:
- Making lifecycle fund allocations responsive to Monte Carlo market conditions
- Providing hybrid approaches that combine lifecycle fund strategies with market variability
- Adding validation warnings when lifecycle funds are used with Monte Carlo simulations
